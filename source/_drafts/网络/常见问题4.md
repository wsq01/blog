

# 交换机分类
交换机可以分为核心交换机、汇聚交换机、接入交换机。

核心交换机不是某种网络交换机，它是指位于网络主干或物理核心的数据交换机，因此，它必须是一个大容量的交换机，以作为通往广域网（WAN）或互联网的网关，总之，它为网络提供了最终的聚合点，并允许各种聚合模块协同工作。

汇聚交换机位于汇聚层，向上连接核心交换机，向下连接到接入交换机，也称为分布交换机，作为核心层交换机和接入层交换机之间的桥梁。

此外，汇聚交换机确保数据包在企业网络中的子网和 VLAN 之间正确路由。

接入交换机一般位于接入层，用于将大多数设备连接到网络，因此通常具有高密度端口，它是最常用的千兆以太网交换机，直接与公共互联网通信，主要用于办公室、小型服务器机房和媒体制作中心，托管和非托管交换机都可以部署为接入层交换机。

交换机可以共存于同一网络中，并相互协调以实现不受限制的网络速度，每个层交换机执行自己的职责。那么，核心交换机、汇聚交换机、接入交换机有什么区别呢？
## 核心交换机与汇聚交换机
核心交换机比汇聚交换机具有更高的可靠性、功能性和吞吐量。

前者针对路由转发，提供优化可靠的骨干传输结构，后者作为接入节点的统一出口，也可以做路由转发。

汇聚交换机必须有足够大的容量来处理来自接入设备的所有流量，更重要的是，中小型网络中通常只有一个（或两个用于冗余）核心交换机，而汇聚层则有多个汇聚交换机。
## 核心交换机与接入交换机
交换机所在的级别越低，它连接的设备就越多，因此，接入交换机和核心交换机的端口数量存在较大差距，大多数接入交换机需要连接各种终端用户设备，从 IP 电话到 PC、相机等，而核心交换机可能只与几个分布交换机相连。

同时，交换机所在的层数越高，它需要的端口速度就越快。接入交换机之于核心交换机，就像河流之于海洋一样，因为后者具有较大的吞吐量来接收来自前者的数据包。大多数现代接入交换机都带有 10/100/1000Mbps 铜缆端口，而核心交换机 通常有 10Gbps 和 100Gbps 光纤端口。
## 汇聚交换机与接入交换机
由于接入交换机是允许您的设备连接网络的交换机，它无疑支持端口安全、VLAN、快速以太网/千兆以太网等，主要负责路由和基于策略的网络连接的汇聚交换机支持额外的更高性能，例如包过滤、QoS 和应用程序网关。
# 结论
* 接入交换机为设备接入网络提供了便利。
* 分布交换机接受所有接入层交换机的流量，支持更多的高端特性。
* 核心交换机负责最高级别的路由和转发。

# ACL
`ACL(Access Control List)`，中文名称叫“访问控制列表”，它由一系列规则（即描述报文匹配条件的判断语句）组成。这些条件，可以是报文的源地址、目的地址、端口号等。

打个比方，ACL 其实是一种报文过滤器，ACL 规则就是过滤器的滤芯。安装什么样的滤芯（即根据报文特征配置相应的 ACL 规则），ACL 就能过滤出什么样的报文了。

基于过滤出的报文，我们能够做到阻塞攻击报文、为不同类报文流提供差分服务、对 Telnet 登录/FTP 文件下载进行控制等等，从而提高网络环境的安全性和网络传输的可靠性。

{% asset_img 1.png %}
# ACL分类
首先，图中是一个数字型 ACL，ACL 编号为 2000。这类似于人类的身份证号，用于唯一标识自己的身份。除了数字型 ACL，还有一种叫做命名型的 ACL，它就能拥有自己的 ACL 名称。
```
acl name deny-telnet-login 3998
rule 0 deny tcp source 10.152.0.0 0.0.63.255 destination 10.64.0.97 0 destination-port eq telnet
rule 5 deny tcp source 10.242.128.0 0.0.127.255 destination 10.64.0.97 0 destination-port eq telnet
```
通过名称代替编号来定义 ACL，就像用域名代替IP地址一样，可以方便记忆，也让大家更容易识别此ACL的使用目的。

命名型 ACL 实际上是“名字+数字”的形式，可以在定义命名型 ACL 时同时指定 ACL 编号。如果不指定编号，则由系统自动分配。上图就是一个既有名字`deny-telnet-login`又有编号 3998 的 ACL。

实际上，按照 ACL 规则功能的不同，ACL 被划分为基本 ACL、高级 ACL、二层 ACL、用户自定义 ACL 和用户 ACL 这五种类型。每种类型 ACL 对应的编号范围是不同的。ACL 2000 属于基本 ACL，ACL 3998 属于高级 ACL。高级 ACL 可以定义比基本 ACL 更准确、更丰富、更灵活的规则，所以高级 ACL 的功能更加强大。

| ACL类别       | 规则定义描述 | 编号范围 |
| :--: | :--: | :--: |
| 基本ACL       | 仅使用报文的源IP地址、分片标记和时间段信息来定义规则。 | 2000～2999 |
| 高级ACL       | 既可使用报文的源IP地址，也可使用目的地址、IP优先级、ToS、DSCP、IP协议类型、ICMP类型、TCP源端口/目的端口、UDP源端口/目的端口号等来定义规则。 | 3000～3999 |
| 二层ACL	      | 可根据报文的以太网帧头信息来定义规则，如根据源MAC地址、目的MAC地址、以太帧协议类型等。 | 4000～4999 |
| 用户自定义ACL | 可根据报文偏移位置和偏移量来定义规则。 | 5000～5999 |
| 用户ACL       | 既可使用IPv4报文的源IP地址或源UCL（User Control List）组，也可使用目的地址或目的UCL组、IP协议类型、ICMP类型、TCP源端口/目的端口、UDP源端口/目的端口号等来定义规则。 | 	6000～9999 |

# ACL规则
接下来，我们来看看图中 ACL 的`deny | permit`语句。这些条件语句，我们称作 ACL 规则。其中的`deny | permit`，称作 ACL 动作，表示拒绝/允许。

每条规则都拥有自己的规则编号，如5、10、4294967294。这些编号，可以自行配置，也可以由系统自动分配。

ACL 规则的编号范围是 0～4294967294，所有规则均按照规则编号从小到大进行排序。所以，上图中我们可以看到`rule 5`排在首位，而规则编号最大的`rule 4294967294`排在末位。系统按照规则编号从小到大的顺序，将规则依次与报文匹配，一旦匹配上一条规则即停止匹配。

除了包含 ACL 动作和规则编号，我们可以看到 ACL 规则中还定义了源地址、生效时间段这样的字段。这些字段，称作匹配选项，它是 ACL 规则的重要组成部分。

其实，ACL 提供了极其丰富的匹配选项。你可以选择二层以太网帧头信息（如源 MAC、目的 MAC、以太帧协议类型）作为匹配选项，也可以选择三层报文信息（如源地址、目的地址、协议类型）作为匹配选项，还可以选择四层报文信息（如 TCP/UDP 端口号）等等等等。

你只需分析清楚需要过滤的报文的特征，便可以指定使用哪一种 ACL 匹配选项，从而让 ACL 能正确的识别需过滤的报文。
# 步长
步长，是指系统自动为 ACL 规则分配编号时，每个相邻规则编号之间的差值。也就是说，系统是根据步长值自动为 ACL 规则分配编号的。

图中的 ACL 2000，步长就是 5。系统按照5、10、15…这样的规律为 ACL 规则分配编号。如果将步长调整为了 2，那么规则编号会自动从步长值开始重新排列，变成 2、4、6…。
```
[HUAWEI-acl-basic-2000]display acl 2000
Basic ACL 2000,3 rules
ACL’s step is 5
  rule 5 permit source 1.1.1.0 0.0.0.255(match-counter 0)
  rule 10 permit source 2.2.2.0 0.0.0.255(match-counter 0)
  rule 15 permit source 3.3.3.0 0.0.0.255(match-counter 0)
  
[HUAWEI-acl-basic-2000]step 2
[HUAWEI-acl-basic-2000]display acl 2000
ACL’s step is 5
  rule 2 permit source 1.1.1.0 0.0.0.255(match-counter 0)
  rule 4 permit source 2.2.2.0 0.0.0.255(match-counter 0)
  rule 6 permit source 3.3.3.0 0.0.0.255(match-counter 0)
```
ACL 的缺省步长值是 5。通过`display acl acl-number`命令，可以查看 ACL 规则、步长等配置信息。通过`step step`命令，可以修改 ACL 步长值。

实际上，设置步长的目的，是为了方便在 ACL 规则之间插入新的规则。

假设，一条 ACL 中，已包含了下面三条规则 5、10、15。如果你希望源 IP 地址为`1.1.1.3`的报文也被禁止通过，该如何处理呢？
```
rule 5 deny source 1.1.1.1 0  //表示禁止源IP地址为1.1.1.1的报文通过                  
rule 10 deny source 1.1.1.2 0 //表示禁止源IP地址为1.1.1.2的报文通过                   
rule 15 permit source 1.1.1.0 0.0.0.255 //表示允许源IP地址为1.1.1.0网段的报文通过
```
我们来分析一下。由于 ACL 匹配报文时遵循“一旦命中即停止匹配”的原则，所以源 IP 地址为`1.1.1.1`和`1.1.1.2`的报文，会在匹配上编号较小的`rule 5`和`rule 10`后停止匹配，从而被系统禁止通过；而源 IP 地址为`1.1.1.3`的报文，则只会命中`rule 15`，从而得到系统允许通过。要想让源 IP 地址为`1.1.1.3`的报文也被禁止通过，我们必须为该报文配置一条新的`deny`规则。
```
rule 5 deny source 1.1.1.1 0  //表示禁止源IP地址为1.1.1.1的报文通过                  
rule 10 deny source 1.1.1.2 0 //表示禁止源IP地址为1.1.1.2的报文通过                   
rule 11 deny source 1.1.1.3 0 //表示禁止源IP地址为1.1.1.3的报文通过 
rule 15 permit source 1.1.1.0 0.0.0.255 //表示允许源IP地址为1.1.1.0网段的报文通过
```
在`rule 10`和`rule 15`之间插入`rule 11`后，源 IP 地址为`1.1.1.3`的报文，就可以先命中`rule 11`而停止继续往下匹配，所以该报文将会被系统禁止通过。

试想一下，如果这条 ACL 规则之间间隔不是 5，而是 1（`rule 1、rule 2、rule 3…`），这时再想插入新的规则，只能先删除已有的规则，然后再配置新规则，最后将之前删除的规则重新配置回来。如果这样做，那付出的代价可真是太大了！

所以，通过设置 ACL 步长，为规则之间留下一定的空间，后续再想插入新的规则，就非常轻松了。