

# 国密算法
国密算法包括 SM1（SCB2）、SM2、SM3、SM4、SM7、SM9 以及祖冲之密码算法（ZUC）等。其中，SM1、SM4、SM7、祖冲之密码（ZUC）属于对称算法；SM2、SM9 属于非对称算法；SM3 属于杂凑算法。

{% asset_img 1.png %}

## SM1算法
SM1 算法是国密算法中的一种对称加密算法，其特点是加解密使用相同密钥。利用SM1对称加密算法加解密数据的过程。

SM1 算法未公开，仅以IP核（`Intellectual Property Core`，一种预先做好的集成电路功能模块）的形式存在于芯片中。SM1 算法主要用于小数据量的加密保护，因此被广泛用于研制智能 IC 卡、智能密码钥匙、门禁卡、加密卡等安全产品。

{% asset_img 2.png %}

## SM2算法
SM2 算法是基于ECC（`Elliptic Curve Cryptography`）椭圆曲线的非对称加密算法，包括了 SM2-1 椭圆曲线数字签名算法、SM2-2 椭圆曲线密钥交换协议和 SM2-3 椭圆曲线公钥加密算法，分别用于实现数字签名、密钥协商和数据加密等功能。

### 数据加密
在非对称加密算法中，可对外公布的密钥称为“公钥”，只有持有者所知的密钥称为“私钥”。发送者使用接收者的公钥来加密消息，接收者用自己的私钥解密和读取该消息。

利用 SM2 非对称加密算法加解密数据的过程。

{% asset_img 3.png %}

## 密钥协商
由于椭圆曲线的计算复杂性高，破解难度大，因此 SM2 算法在密钥协商技术领域也起着关键作用。利用 SM2 算法进行密钥协商的过程。
1. 会话双方生成自己的私钥（随机数）。
2. 会话双方由私钥、ECC椭圆曲线参数G各自计算出公钥。
3. 会话双方将自己的公钥传递给对方，传递过程公开。由于椭圆曲线的计算复杂性高，破解难度大，因此攻击者难以通过公钥和椭圆曲线参数G反推出私钥。
4. 双方将自己的私钥与对方的公钥进行运算，最终得到相同的会话密钥，该会话密钥可作为共享密钥用于对称加密（例如SM4算法）通信。

{% asset_img 4.png %}

### 数字签名
数字签名是一种用于验证信息完整性、真实性和来源的技术手段。它通常用于确保数据在传输或存储过程中没有被篡改，并且可以追溯到特定的发送方。发送方使用自己的私钥对消息进行加密，生成数字签名。接收方使用发送方的公钥对签名进行解密和验证，以验证消息的完整性和真实性。

在数字签名应用中，SM2 算法通常与 SM3 摘要算法一起使用。

## SM3算法
SM3杂凑（`Hashing`）算法是国密算法中的一种摘要算法。SM3 算法通过哈希函数将任意长度的消息压缩成固定长度的摘要。摘要具有唯一性，即不同信息生成的摘要不同，且无法由摘要恢复出原始信息，更无法伪造信息获得相同摘要，因此 SM3 算法被广泛用于实现数字签名、数据完整性检测及消息验证等功能。

利用 SM2 算法和 SM3 算法对用户数据进行数字签名认证及完整性校验的过程。
1. 用户 A 发送的数据 A 经过 SM3 哈希算法运算生成摘要 A。
2. 摘要 A 经过用户 A 的私钥加密生成数字签名。
3. 用户 A 的明文数据和数字签名经加密算法（SM1/SM2/SM4）加密成密文后发送给用户 B。加密算法以非对称加密算法 SM2 为例，即加解密使用不同密钥。
4. 密文到达用户 B 处，经加密算法（SM1/SM2/SM4）解密后，还原成明文数据和数字签名。
5. 用户 B 使用用户 A 的公钥解密数据包中的数字签名：
 * 解密成功，数据来源合法，得到摘要 A；
 * 解密失败，数据来源非用户 A，丢弃本次数据。
6. 收到的数据包中的明文数据经过SM3哈希运算生成摘要 A’。对比摘要 A 和摘要 A’：
 * 摘要 A’＝摘要 A，数据完整；
 * 摘要 A’ ≠ 摘要 A，数据被篡改，丢弃本次数据。

{% asset_img 5.png %}

## SM4算法
与 SM1 算法分类相同，SM4算法同样为分组对称加密算法，但 SM4 算法实现公开。

分组加密算法是将明文数据按固定长度进行分组，用同一密钥逐组加密，密文解密时同样使用相同密钥逐组解密。SM4算法实现简单，因此加解密速度较快，消耗资源少，主要用于大数据量的加密和解密，例如静态储存或数据信号传输通道中数据的加解密。

### 加解密模式
SM4 算法支持 ECB、CBC、CFB 等多种分组模式。
#### ECB模式
SM4算法基于ECB模式对数据加解密的过程。
1. 发送端将明文按固定长度分组，对每个明文分组分别使用相同的密钥进行加密生成密文分组。完整的密文由所有密文分组按序排列组合而成。
2. 接收端将密文按固定长度分组，对每个密文分组分别使用相同的密钥进行解密生成明文分组。所有明文分组按序排列组合而成完整的明文数据。

ECB 模式实现简单，各段数据间互不影响，有利于并行运算，但相同的明文块会被加密成相同的密文块，不能提供严格的数据保密性。

{% asset_img 6.png %}

#### CBC模式
SM4 算法基于CBC 模式对明文加密的过程。
1. 将明文按固定长度分组。
2. 明文分组1与初始向量IV进行异或运算，异或运算的结果经密钥加密后得到密文分组1。
3. 剩余的明文分组依次与前一个密文分组进行异或运算后再加密，得到对应的密文分组。
4. 完整的密文由所有密文分组按序排列组合而成。

{% asset_img 7.png %}

SM4 算法基于 CBC 模式对密文解密的过程。
1. 将密文按固定长度分组后，对密文分组进行倒序处理。
2. 对密文分组 n 先使用密钥进行解密，密文分组 n 解密后的数据与密文分组 n-1 进行逻辑逆运算，得到明文分组 n。
3. 同理，剩余的密文分组解密后再与前一个密文分组进行逻辑逆运算，得到对应的明文分组。
4. 最后，密文分组 1 用密钥解密后的数据是与初始向量进行逻辑逆运算，然后得到明文分组 1。
5. 完整的明文由所有明文分组按序排列组合而成。

CBC 模式安全性高于 ECB，但明文块不能并行计算，且误差会传递下去。

{% asset_img 8.png %}

## 国密算法与国际标准算法的对比
国密算法和国际标准算法都是现代密码学中常用的加密算法，但在技术和优劣方面存在一些区别。常见国密算法与国际标准算法各参数性能的对比如下：

| 对比项 | 计算结构 | 分组长度 | 密钥长度 | 计算轮次 | 安全性 |
| :--: | :--: | :--: | :--: | :--: | :--: |
| DES算法 | 难，基于标准的算数和逻辑运算，不含非线性变换 | 64位  | 64位（3DES为128位） | 16轮（3DES为48轮） | 较低（3DES较高） |
| AES算法 | 极难，基于字节代换、行代换等，不含非线性变换 | 128位 | 128/192/256位      | 20/12/14轮         | 较高            |
| SM1算法 | 未公开                                     | 128位| 128位               |  未公开            |   与AES相当     |
| SM4算法 | 极难，基于基本轮函数+迭代，含非线性变换      | 128位 | 128位              |   32轮             |   较高          |


| 对比项 | RSA算法 | SM2算法 |
| :--: | :--: | :--: |
| 计算结构 | 难，基于可逆幂模运算 | 极难，基于椭圆曲线上点群离散对数难题 |
| 计算复杂度 | 亚指数级 | 完全指数级 |
| 密钥长度（相同安全性能下） | 较长 | 较短 |
| 密钥生成速度 | 慢 | 较RAS算法快百倍以上 |
| 安全性 | 一般 | 较高 |


| 对比项 | SHA1算法 | SHA256算法 | SM3算法 |
| :--: | :--: | :--: | :--: |
| 计算结构| | | 函数结构类似，但SM3算法设计更复杂 |
| 摘要长度 | 160位 | 256位 | 256位 |
| 运算速度 | 较快 | 略低于SHA1 | 略低于SHA1 |
| 安全性 | 一般 | 较高 | 高于SHA256 |