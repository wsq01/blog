---
title: vue3æ–°è¯­æ³•
date: 2022-07-20 16:12:35
tags: vue
categories: vue
---

# setup
åœ¨`script`æ ‡ç­¾ä¸­æ·»åŠ `setup`ï¼Œç»„ä»¶åªéœ€å¼•å…¥ä¸ç”¨æ³¨å†Œï¼Œå±æ€§å’Œæ–¹æ³•ä¹Ÿä¸ç”¨è¿”å›ï¼Œä¹Ÿä¸ç”¨å†™`setup`å‡½æ•°ï¼Œä¹Ÿä¸ç”¨å†™`export default`ï¼Œç”šè‡³æ˜¯è‡ªå®šä¹‰æŒ‡ä»¤ä¹Ÿå¯ä»¥åœ¨æˆ‘ä»¬çš„`template`ä¸­è‡ªåŠ¨è·å¾—ã€‚
```
<template>
  <div class="home">
    æ˜¾ç¤ºçš„å€¼{{flag }}
    <button @click="changeHander">æ”¹å˜å€¼</button>
  </div>
</template>
<!-- åªéœ€è¦åœ¨scriptä¸Šæ·»åŠ setup -->
<script lang="ts" setup>
    import { ref } from 'vue';

    <!-- flagå˜é‡ä¸éœ€è¦åœ¨ returnå‡ºå»äº† -->
    let flag=ref("å¼€ç«¯-ç¬¬ä¸€æ¬¡å¾ªç¯")

    <!-- å‡½æ•°ä¹Ÿå¯ä»¥ç›´æ¥å¼•ç”¨,ä¸ç”¨åœ¨returnä¸­è¿”å› -->
    let changeHander=():void=>{
        flag.value='å¼€ç«¯-ç¬¬äºŒæ¬¡å¾ªç¯'
    }

</script>
```
# ç»„ä»¶ä¸éœ€è¦åœ¨æ³¨å†Œ
åœ¨`script setup`ä¸­ï¼Œå¼•å…¥çš„ç»„ä»¶å¯ä»¥ç›´æ¥ä½¿ç”¨æ— éœ€å†é€šè¿‡`components`è¿›è¡Œæ³¨å†Œï¼Œå¹¶ä¸”æ— æ³•æŒ‡å®šå½“å‰ç»„ä»¶çš„åå­—ï¼Œå®ƒä¼šè‡ªåŠ¨ä»¥æ–‡ä»¶åä¸ºä¸»ï¼Œä¹Ÿå°±æ˜¯ä¸ç”¨å†å†™`name`å±æ€§äº†ã€‚
```
<!-- è¿™ä¸ªæ˜¯ç»„ä»¶ -->
<template>
    <div>
        <h2> ä½ å¥½-æˆ‘æ˜¯è‚–é¹¤äº‘</h2>
    </div>
</template>


ä½¿ç”¨çš„é¡µé¢
<template>
  <div class="home">
    <test-com></test-com>
  </div>
</template>
<script lang="ts" setup>
// ç»„ä»¶å‘½åé‡‡ç”¨çš„æ˜¯å¤§é©¼å³°ï¼Œå¼•å…¥åä¸éœ€è¦åœ¨æ³¨å†Œï¼Œæ˜¯ä¸æ˜¯çˆ½æ­ªæ­ªå‘€!
//åœ¨ä½¿ç”¨çš„ä½¿ç”¨ç›´æ¥æ˜¯å°å†™å’Œæ¨ªæ çš„æ–¹å¼è¿æ¥ test-com
import TestCom from "../components/TestCom.vue"
</script>
```
# defineProps
å­ç»„ä»¶æ¥å—çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„å€¼ï¼Œä»£æ›¿`props`ã€‚
```
çˆ¶ç»„ä»¶ä¼ é€’å‚æ•°
<template>
  <div class="home">
    <test-com :info="msg" time="42åˆ†é’Ÿ"></test-com>
  </div>
</template>
<script lang="ts" setup>
// ç»„ä»¶å‘½åé‡‡ç”¨çš„æ˜¯å¤§é©¼å³°ï¼Œå¼•å…¥åä¸éœ€è¦åœ¨æ³¨å†Œï¼Œæ˜¯ä¸æ˜¯çˆ½æ­ªæ­ªå‘€!
import TestCom from "../components/TestCom.vue"
let msg='å…¬äº¤è½¦-ç¬¬ä¸€æ¬¡å¾ªç¯'
</script>
```
```
å­ç»„ä»¶æ¥å—å‚æ•°
<template>
    <div>
        <h2> ä½ å¥½-æˆ‘æ˜¯è‚–é¹¤äº‘</h2>
        <p>ä¿¡æ¯:{{ info}}</p>
        <p>{{ time }}</p>
    </div>
</template>
<script lang="ts" setup>
import {defineProps} from 'vue'
defineProps({
    info:{
        type:String,
        default:'----'
    },
    time:{
        type:String,
        default:'0åˆ†é’Ÿ'
    },
})
</script>
```
# defineEmits
å­ç»„ä»¶å‘çˆ¶ç»„ä»¶æŠ›å‡ºäº‹ä»¶ï¼Œä»£æ›¿`$emit`ã€‚
```
å­ç»„ä»¶
<template>
    <div>
        <h2> ä½ å¥½-æˆ‘æ˜¯è‚–é¹¤äº‘</h2>
        <button @click="hander1Click">æ–°å¢</button>
        <button @click="hander2Click">åˆ é™¤</button>
    </div>
</template>

<script lang="ts" setup>
 import {defineEmits} from 'vue'
//  ä½¿ç”¨defineEmitsåˆ›å»ºåç§°ï¼Œæ¥å—ä¸€ä¸ªæ•°ç»„
let $myemit=defineEmits(['myAdd','myDel'])
let hander1Click=():void=>{
    $myemit('myAdd','æ–°å¢çš„æ•°æ®')
}

let hander2Click=():void=>{
    $myemit('myDel','åˆ é™¤çš„æ•°æ®')
}
</script>
```
```
çˆ¶ç»„ä»¶
<template>
  <div class="home">
    <test-com @myAdd="myAddHander" @myDel='myDelHander'></test-com>
  </div>
</template>
<script lang="ts" setup>
// ç»„ä»¶å‘½åé‡‡ç”¨çš„æ˜¯å¤§é©¼å³°ï¼Œå¼•å…¥åä¸éœ€è¦åœ¨æ³¨å†Œï¼Œæ˜¯ä¸æ˜¯çˆ½æ­ªæ­ªå‘€!
//åœ¨ä½¿ç”¨çš„ä½¿ç”¨ç›´æ¥æ˜¯å°å†™å’Œæ¨ªæ çš„æ–¹å¼è¿æ¥ test-com
import TestCom from "../components/TestCom.vue"
let myAddHander=(mess):void=>{
  console.log('æ–°å¢==>',mess);
}

let myDelHander=(mess):void=>{
  console.log('åˆ é™¤==>', mess);
}
</script>
```
# è·å–å­ç»„ä»¶ä¸­çš„å±æ€§å€¼
```
å­ç»„ä»¶
<template>
    <div>
        <h2> ä½ å¥½-æˆ‘æ˜¯è‚–é¹¤äº‘</h2>
        <p>æ€§åˆ«:{{ sex}}</p>
        <p>å…¶ä»–ä¿¡æ¯:{{ info}}</p>
    </div>
</template>

<script lang="ts" setup>
import { reactive, ref,defineExpose } from "vue";
let sex=ref('ç”·')
let info=reactive({
    like:'å–œæ¬¢æè¯—æ™´',
    age:27
})
// å°†ç»„ä»¶ä¸­çš„å±æ€§æš´éœ²å‡ºå»ï¼Œè¿™æ ·çˆ¶ç»„ä»¶å¯ä»¥è·å–
defineExpose({
    sex,
    info
})
</script>
```
```
çˆ¶ç»„ä»¶
<template>
  <div class="home">
    <test-com @myAdd="myAddHander" @myDel='myDelHander' ref="testcomRef"></test-com>
    <button @click="getSonHander">è·å–å­ç»„ä»¶ä¸­çš„æ•°æ®</button>
  </div>
</template>
<script lang="ts" setup>
import TestCom from "../components/TestCom.vue"
import {ref} from 'vue'
const testcomRef = ref()
const getSonHander=()=>{
  console.log('è·å–å­ç»„ä»¶ä¸­çš„æ€§åˆ«', testcomRef.value.sex );
  console.log('è·å–å­ç»„ä»¶ä¸­çš„å…¶ä»–ä¿¡æ¯', testcomRef.value.info );
}
</script>
```
# style v-bind
æˆ‘ä»¬å¯ä»¥åœ¨`style`ä¸­å»ä½¿ç”¨å˜é‡ã€‚
```
<template>
  <span> æœ‰å¼€å§‹å¾ªç¯äº†-å¼€ç«¯ </span>  
</template>
<script setup>
  import { reactive } from 'vue'
  const state = reactive({
    color: 'red'
  })
</script>
<style scoped>
  span {
    /* ä½¿ç”¨v-bindç»‘å®šstateä¸­çš„å˜é‡ */
    color: v-bind('state.color');
  }  
</style>
```
# ç”Ÿå‘½å‘¨æœŸçš„å˜åŒ–
æ•´ä½“æ¥çœ‹ï¼Œå˜åŒ–ä¸å¤§ï¼Œåªæ˜¯åå­—å¤§éƒ¨åˆ†éœ€è¦`+on`ï¼ŒåŠŸèƒ½ä¸Šç±»ä¼¼ã€‚ä½¿ç”¨ä¸Š Vue3 ç»„åˆå¼ API éœ€è¦å…ˆå¼•å…¥ï¼›Vue2 é€‰é¡¹ API åˆ™å¯ç›´æ¥è°ƒç”¨ã€‚
```
// vue3
<script setup>     
import { onMounted } from 'vue'

onMounted(() => {
  ...
})
// å¯å°†ä¸åŒçš„é€»è¾‘æ‹†å¼€æˆå¤šä¸ªonMountedï¼Œä¾ç„¶æŒ‰é¡ºåºæ‰§è¡Œï¼Œä¸è¢«è¦†ç›–
onMounted(() => {
  ...
})
</script>

// vue2
<script>     
   export default {         
      mounted() {             
        ...         
      },           
   }
</script> 
```

| Vue2.x | Vue3 |
| :--: | :--: |
| beforeCreate | Not needed* |
| created | Not needed* |
| beforeMount | onBeforeMount |
| mounted | onMounted |
| beforeUpdate | onBeforeUpdate |
| updated | onUpdated |
| beforeDestroy | onBeforeUnmount |
| destroyed | onUnmounted |

`setup`æ˜¯å›´ç»•`beforeCreate`å’Œ`created`ç”Ÿå‘½å‘¨æœŸé’©å­è¿è¡Œçš„ï¼Œæ‰€ä»¥ä¸éœ€è¦æ˜¾å¼åœ°å»å®šä¹‰ã€‚
# å¤šæ ¹èŠ‚ç‚¹
Vue3 æ”¯æŒäº†å¤šæ ¹èŠ‚ç‚¹ç»„ä»¶ã€‚
```
<template>
  <header>...</header>
  <main>...</main>
  <footer>...</footer>
</template>
```
# å¼‚æ­¥ç»„ä»¶
Vue3 æä¾›`Suspense`ç»„ä»¶ï¼Œå…è®¸ç¨‹åºåœ¨ç­‰å¾…å¼‚æ­¥ç»„ä»¶æ—¶æ¸²æŸ“å…œåº•çš„å†…å®¹ï¼Œå¦‚`loading`ï¼Œä½¿ç”¨æˆ·ä½“éªŒæ›´å¹³æ»‘ã€‚ä½¿ç”¨å®ƒï¼Œéœ€åœ¨æ¨¡æ¿ä¸­å£°æ˜ï¼Œå¹¶åŒ…æ‹¬ä¸¤ä¸ªå‘½åæ’æ§½ï¼š`default`å’Œfallbackã€‚Suspenseç¡®ä¿åŠ è½½å®Œå¼‚æ­¥å†…å®¹æ—¶æ˜¾ç¤ºé»˜è®¤æ’æ§½ï¼Œå¹¶å°†`fallback`æ’æ§½ç”¨ä½œåŠ è½½çŠ¶æ€ã€‚
```
<tempalte>
   <suspense>
     <template #default>
       <todo-list />
     </template>
     <template #fallback>
       <div>
         Loading...
       </div>
     </template>
   </suspense>
</template>
```
# Teleport
Vue3 æä¾›`Teleport`ç»„ä»¶å¯å°†éƒ¨åˆ† DOM ç§»åŠ¨åˆ° Vue `app`ä¹‹å¤–çš„ä½ç½®ã€‚æ¯”å¦‚é¡¹ç›®ä¸­å¸¸è§çš„`Dialog`ç»„ä»¶ã€‚
```
<button @click="dialogVisible = true">ç‚¹å‡»</button>
<teleport to="body">
   <div class="dialog" v-if="dialogVisible">
   </div>
</teleport>
```
# ç»„åˆå¼API
Vue2 æ˜¯é€‰é¡¹å¼`APIï¼ˆOption APIï¼‰`ï¼Œä¸€ä¸ªé€»è¾‘ä¼šæ•£ä¹±åœ¨æ–‡ä»¶ä¸åŒä½ç½®ï¼ˆ`dataã€propsã€computedã€watch`ã€ç”Ÿå‘½å‘¨æœŸå‡½æ•°ç­‰ï¼‰ï¼Œå¯¼è‡´ä»£ç çš„å¯è¯»æ€§å˜å·®ï¼Œéœ€è¦ä¸Šä¸‹æ¥å›è·³è½¬æ–‡ä»¶ä½ç½®ã€‚

Vue3 ç»„åˆå¼APIï¼ˆ`Composition API`ï¼‰åˆ™å¾ˆå¥½åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå¯å°†åŒä¸€é€»è¾‘çš„å†…å®¹å†™åˆ°ä¸€èµ·ã€‚

é™¤äº†å¢å¼ºäº†ä»£ç çš„å¯è¯»æ€§ã€å†…èšæ€§ï¼Œç»„åˆå¼API è¿˜æä¾›äº†è¾ƒä¸ºå®Œç¾çš„é€»è¾‘å¤ç”¨æ€§æ–¹æ¡ˆï¼Œä¸¾ä¸ªğŸŒ°ï¼Œå¦‚ä¸‹æ‰€ç¤ºå…¬ç”¨é¼ æ ‡åæ ‡æ¡ˆä¾‹ã€‚
```
// main.vue
<template>
  <span>mouse position {{x}} {{y}}</span>
</template>

<script setup>
import { ref } from 'vue'
import useMousePosition from './useMousePosition'

const {x, y} = useMousePosition()

}
</script>
```
```
// useMousePosition.js
import { ref, onMounted, onUnmounted } from 'vue'

function useMousePosition() {
  let x = ref(0)
  let y = ref(0)
  
  function update(e) {
    x.value = e.pageX
    y.value = e.pageY
  }
  
  onMounted(() => {
    window.addEventListener('mousemove', update)
  })
  
  onUnmounted(() => {
    window.removeEventListener('mousemove', update)
  })
  
  return {
    x,
    y
  }
}
</script>
```
è§£å†³äº† Vue2 `Mixin`çš„å­˜åœ¨çš„å‘½åå†²çªéšæ‚£ï¼Œä¾èµ–å…³ç³»ä¸æ˜ç¡®ï¼Œä¸åŒç»„ä»¶é—´é…ç½®åŒ–ä½¿ç”¨ä¸å¤Ÿçµæ´»ã€‚
