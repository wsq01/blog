---
title: Linux vim编辑器
date: 2022-01-17 18:13:15
tags: [Linux]
categories: [Linux]
---


# Vim三种工作模式
使用 Vim 编辑文件时，存在 3 种工作模式，分别是命令模式、输入模式和编辑模式，这 3 种工作模式可随意切换。

{% asset_img 1.jpg %}

## 命令模式
使用 Vim 编辑文件时，默认处于命令模式。此模式下，可使用方向键（上、下、左、右键）或`k、j、h、i`移动光标的位置，还可以对文件内容进行复制、粘贴、替换、删除等操作。
## 输入模式
在输入模式下，Vim 可以对文件执行写操作。

使 Vim 进行输入模式的方式是在命令模式状态下输入`i、I、a、A、o、O`等插入命令，当编辑文件完成后按 Esc 键即可返回命令模式。
## 编辑模式
编辑模式用于对文件中的指定内容执行保存、查找或替换等操作。

使 Vim 切换到编辑模式的方法是在命令模式状态下按`:`键，此时 Vim 窗口的左下方出现一个`:`符号，这是就可以输入相关指令进行操作了。

指令执行后 Vim 会自动返回命令模式。如想直接返回命令模式，按 Esc 即可。
# Vim基本操作
## 打开文件
使用 Vim 打开文件很简单，例如在命令行模式下打开一个自己编写的文件`/test/vi.test`，打开方法如下：
```
[root@itxdl ~]# vim /test/vi.test
```
刚打开文件时 Vim 处于命令模式，此时文件的下方会显示文件的一些信息，包括文件的总行数和字符数，以及当前光标所在的位置等，此时可以使用插入命令进入输入模式对文件进行编辑。
## 使用 Vim 进行编辑
同样，Vim 提供了大量的编辑快捷键，主要可分为以下几类。
### 插入文本
从命令模式进入输入模式进行编辑，可以按下`I、i、O、o、A、a`等键来完成，使用不同的键，光标所处的位置不同。

| 快捷键 | 功能描述 |
| :--: | :-- |
| i	| 在当前光标所在位置插入随后输入的文本，光标后的文本相应向右移动 |
| I	| 在光标所在行的行首插入随后输入的文本，行首是该行的第一个非空白字符，相当于光标移动到行首执行 i 命令 |
| o	| 在光标所在行的下面插入新的一行。光标停在空行首，等待输入文本 |
| O	| 在光标所在行的上面插入新的一行。光标停在空行的行首，等待输入文本 |
| a	| 在当前光标所在位置之后插入随后输入的文本 |
| A	| 在光标所在行的行尾插入随后输入的文本，相当于光标移动到行尾再执行a命令 |

### 查找文本
| 快捷键  | 功能描述 |
| :--: | :-- |
| /abc    | 从光标所在位置向前查找字符串 abc |
| /^abc   | 查找以 abc 为行首的行 |
| /abc$   | 查找以 abc 为行尾的行 |
| ?abc    | 从光标所在位置向后查找字符串 abc |
| n       | 向同一方向重复上次的查找指令 |
| N       | 向相反方向重复上次的查找指定 |

如果在文件中并没有找到所要查找的字符串，则在文件底部会出现`Pattern not found`提示。

在查找过程中需要注意的是，要查找的字符串是严格区分大小写的。如果想忽略大小写，则输入命令`:set ic`；调整回来输入`:set noic`。

如果在字符串中出现特殊符号，则需要加上转义字符`\`。常见的特殊符号有`\、*、?、$`等。如果出现这些字符，例如，要查找字符串`10$`，则需要在命令模式中输入`/10\$`。
### 替换文本

| 快捷键          | 功能描述 |
| :--: | :-- |
| r               | 替换光标所在位置的字符 |
| R               | 从光标所在位置开始替换字符，其输入内容会覆盖掉后面等长的文本内容，按“Esc”可以结束 |
| :s/a1/a2/g	    | 将当前光标所在行中的所有 a1 用 a2 替换 |
| :n1,n2s/a1/a2/g | 将文件中 n1 到 n2 行中所有 a1 都用 a2 替换 |
| :g/a1/a2/g      | 将文件中所有的 a1 都用 a2 替换 |

例如，要将某文件中所有的`root`替换为`liudehua`，则有两种输入命令，分别为：
```
:1, $s/root/liudehua/g
或
:%s/root/liudehua/g
```
上述命令是在编辑模式下操作的，表示的是从第一行到最后一行，即全文查找`root`，然后替换成`liudehua`。

如果刚才的命令变成`:10,20 s/root/liudehua/g`，则只替换从第 10 行到第 20 行的`root`。
### 删除文本

| 快捷键	| 功能描述 |
| :--: | :-- |
| x	      | 删除光标所在位置的字符 |
| dd	    | 删除光标所在行 |
| ndd	    | 删除当前行（包括此行）后 n 行文本 |
| dG	    | 删除光标所在行一直到文件末尾的所有内容 |
| D	      | 删除光标位置到行尾的内容 |
| :a1,a2d | 函数从 a1 行到 a2 行的文本内容 |

注意，被删除的内容并没有真正删除，都放在了剪贴板中。将光标移动到指定位置处，按下 "p" 键，就可以将刚才删除的内容又粘贴到此处。

### 复制和粘贴文本

| 快捷键	| 功能描述 |
| :--: | :-- |
| p       | 将剪贴板中的内容粘贴到光标后 |
| P       | 将剪贴板中的内容粘贴到光标前 |
| y       | 复制已选中的文本到剪贴板 |
| yy      | 将光标所在行复制到剪贴板，此命令前可以加数字 n，可复制多行 |
| yw      | 将光标位置的单词复制到剪贴板 |

## 保存退出文本
Vim 的保存和退出是在编辑模式中进行的，其常用命令：

| 命令	| 功能描述 |
| :--: | :-- |
| :wq   | 保存并退出 Vim 编辑器 |
| :wq!  | 保存并强制退出 Vim 编辑器 |
| :q    | 不保存就退出 Vim 编辑器 |
| :q!   | 不保存，且强制退出 Vim 编辑器 |
| :w    | 保存但是不退出 Vim 编辑器 |
| :w!   | 强制保存文本 |
| :w filename | 另存到 filename 文件 |
| x!    | 保存文本，并退出 Vim 编辑器，更通用的一个 vim 命令 |
| ZZ    | 直接退出 Vim 编辑器 |

# 撤销和恢复
| 快捷键     | 功能 |
| :--: | :-- |
| u（小写）  | undo 的第 1 个字母，功能是撤销最近一次对文本做的修改操作。 |
| Ctrl+R     | Redo 的第 1 个字母，功能是恢复最近一次所做的撤销操作。 |
| U（大写）  | 第一次会撤销对一行文本（光标所在行）做过的全部操作，第二次使用该命令会恢复对该行文本做过的所有操作。 |

# 多窗口编辑模式
在编辑文件时，有时需要参考另一个文件，如果在两个文件之间进行切换则比较麻烦。可以使用 Vim 同时打开两个文件，每个文件分别占用一个窗口。

例如，在査看`/etc/passwd`时需要参考`/etc/shadow`，有两种办法可以实现：
* 先使用 Vim 打开第一个文件，接着输入命令`:sp/etc/shadow`水平切分窗口，然后按回车键；如果想垂直切分窗口则可以输入`:vs/etc/shadow`;
* 可以直接执行命令`vim -o 第一个文件名 第二个文件名`，也就是`vim -o /etc/passwd /etc/shadow`。

切换到另一个文件窗口，可以按`Ctrl+WW`快捷键。
