


# 拥塞控制的一般原理
在计算机网络中的链路容量（即带宽）、交换结点中的缓存和处理机等，都是网络的资源。

在某段时间，若对网络中某一资源的需求超过了该资源所能提供的可用部分，网络的性能就要变坏。这种情况就叫做拥塞(`congestion`)。
## 拥塞产生的原因
网络拥塞往往是由许多因素引起的。例如：
* 点缓存的容量太小；
* 链路的容量不足；
* 处理机处理的速率太慢；
* 拥塞本身会进一步加剧拥塞；

出现拥塞的原因：∑ 对资源需求  > 可用资源

## 拥塞控制与流量控制的区别
所谓拥塞控制就是防止过多的数据注入到网络中，这样可以使网络中的路由器或链路不致过载。拥塞控制所要做 的都有一个前提，就是网络能够承受现有的网络负荷。拥塞控制是一个全局性的过程，涉及到所有的主机、所有的路由器，以及与降低网络传输性能有关的所有因素。

但TCP连接的端点只要迟迟不能收到对方的确认信息，就猜想在当前网络中的某处很可能发生了拥塞，但 这时却无法知道拥塞到底发生在网络的何处，也无法知道发生拥塞的具体原因。

流量控制往往是指点对点通信量的控制，是个端到端的问题（接收端控制发送端）。流量控制所要做的就是抑制发送端发送数据的速率，以便使接收端来得及接收。
## 拥塞控制所起的作用

{% asset_img img1.png %}

拥塞控制的前提：网络能够承受现有的网络负荷。

实践证明，拥塞控制是很难设计的，因为它是一个动态问题。

分组的丢失是网络发生拥塞的征兆而不是原因。

在许多情况下，甚至正是拥塞控制本身成为引起网络性能恶化、甚至发生死锁的原因。

## 开环控制和闭环控制
开环控制就是在设计网络时事先将有关发生拥塞的因素考虑周到，力求网络在工作时不产生拥塞。但一旦整个系统运行起来，就不再中途进行改正了。

闭环控制是基于反馈环路的概念，根据网络当前的运行状态采取相应控制措施。

属于闭环控制的有以下几种措施： 
* 监测网络系统，以便检测到拥塞在何时、何处发生。
* 将拥塞发生的信息传送到可采取行动的地方。
* 调整网络系统的运行以解决出现的问题。

监测网络的拥塞主要指标有：
* 由于缺少缓存空间而被丢弃的分组的百分数；
* 平均队列长度；
* 超时重传的分组数；
* 平均分组时延；
* 分组时延的标准差，等等。

上述这些指标的上升都标志着拥塞的增长。

传递拥塞通知：发送通知拥塞发生的分组；在分组中保留表示拥塞状态的字段；周期性地发出探测分组等。

采取行动的时机过于频繁，会使系统产生不稳定的振荡；过于迟缓地采取行动又不具有任何实用价值。

#解决拥塞的两条思路：增加网络可用资源；减少用户对资源的需求。
# TCP 的拥塞控制方法
TCP 采用基于窗口的方法进行拥塞控制。该方法属于闭环控制方法。
TCP发送方维持一个拥塞窗口 cwnd (Congestion Window)
发送端利用拥塞窗口根据网络的拥塞情况调整发送的数据量。
发送窗口大小不仅取决于接收方窗口，还取决于网络的拥塞状况，所以真正的发送窗口值为：

真正的发送窗口值 = Min (接收方窗口值，拥塞窗口值)

控制拥塞窗口的原则：
* 只要网络没有出现拥塞，拥塞窗口就可以再增大一些，以便把更多的分组发送出去，这样就可以提高网络的利用率。
* 但只要网络出现拥塞或有可能出现拥塞，就必须把拥塞窗口减小一些，以减少注入到网络中的分组数，以便缓解网络出现的拥塞。

## 拥塞的判断
重传定时器超时：网络已经发生了拥塞。

收到三个重复的 ACK：预示网络可能会出现拥塞（实际可能还未发生拥塞）。
## TCP拥塞控制算法
四种拥塞控制算法：
* 慢开始 (slow-start)
* 拥塞避免 (congestion avoidance)
* 快重传 (fast retransmit)
* 快恢复 (fast recovery)

### 慢开始
目的：用来确定网络的负载能力或拥塞程度。
算法的思路：由小到大逐渐增大拥塞窗口数值。
两个变量：
拥塞窗口
初始拥塞窗口值：2 种设置方法。
    1 至 2 个最大报文段 （旧标准）
    2 至 4 个最大报文段 （RFC 5681）
窗口值逐渐增大。
慢开始门限：防止拥塞窗口增长过大引起网络拥塞。
# 主动队列管理 AQM