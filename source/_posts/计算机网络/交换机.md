



## 三层交换机
当我们需要在不同的 LAN 或 VLAN 之间传输数据时，二层交换机就无法满足了。这时需要三层交换机，因为它们将数据包路由到目的地的技术是 IP 地址和子网划分。
 
三层交换机工作在 OSI 参考模型的第3层，并使用 IP 地址执行数据包的路由。它们比二层交换机具有更快的切换速度，甚至比传统路由器更快，因为它们不使用额外的跃点来执行数据包的路由，从而会带来更好的性能。

第3层中的源端设备首先查看自己的路由表，路由表中包含了源 IP 地址、目的 IP 地址和子网掩码的所有信息。然后，根据它从路由表中收集的信息，将数据包发送到目的地，并可以在不同的 LAN、MAN 和 WAN 网络之间进一步传递数据。它遵循最短且安全的路径在终端设备之间传递数据。这就是路由的总体概念。

各种网络可以通过 STM 链路连接在一起，STM 链路有很高的带宽，DS3链路也可以。连接的类型取决于网络的各种参数。
### 三层交换机的特点
三层交换机的各种特性如下所示：
* 执行静态路由，以在不同 VLAN 之间传输数据。而二层设备只能在同一 VLAN 网络之间传输数据。
* 以与路由器相同的方式执行动态路由，这种动态路由技术允许交换机执行最佳数据包路由。
* 根据网络的实时场景提供一组多路径来传递数据包。交换机可以选择最可行的路径来路由数据包，目前流行的路由技术包括 RIP 和 OSPF。
* 有能力识别关于流量流向的交换机的相关 IP 地址信息。
* 能够根据子网划分或 VLAN 流量标记部署 QoS 分类，而不是像二层交换机那样手动配置交换机端口。
* 需要更多的功率来运行，并在交换机之间提供更高带宽的链路，这些链路几乎超过 10Gbits。
* 为数据交换提供高度安全的路径。

### 三层交换机的应用
三层交换机的应用如下:
* 被广泛用于数据中心等大型园区。三层交换机具有静态路由和动态路由等特点，且交换速度比路由器快，因此它被用于局域网连接中，用于多个 VLAN 和 LAN 网络的互连。
* 三层交换机与多台二层交换机相结合，可以支持更多用户接入网络，无需额外部署三层交换机和更多带宽。如果一个网络平台上的终端用户数量增加，那么无需对网络进行任何增强，就可以轻松地将其容纳在同一个运行场景中。
* 三层交换机可以轻松处理高带宽资源和最终用户应用，它提供了 10Gbits 带宽。
* 三层交换机有能力解除过载的路由器的负担。在广域网场景中，每个三层交换机都有一个主路由器，这样交换机就可以管理所有的本地 VLAN 路由。
* 通过遵循上述类型的场景，路由器的工作效率将会提高，并且可以专门用于长距离（WAN）连接和数据传输。
* 三层交换机可以利用其高带宽处理和管理本地连接的服务器和终端设备的路由和流量控制。因此，公司通常使用三层交换机来连接其监控服务器和子系统NOC中心的主机节点。

### 三层交换机的 VLAN 间路由
下图显示了三层交换机与二层交换机相结合的跨 VLAN 路由操作。
 
我们再举个栗子来帮助理解：

在大学中，教职员工和学生的 PC 通过二层和三层交换机连接在不同的 VLAN 上。

{% asset_img 8.png %}

某教职员工 VLAN 的 PC1 想其他教员 VLAN 中的 pc2 进行通信。由于两个终端设备属于不同的 VLAN，我们需要三层交换机将数据从 PC1 路由到 PC2。
 
首先，二层交换机借助硬件部分的 MAC 地址表来定位目标主机。然后从 MAC 表中学习接收主机的目的地址。之后，三层交换机根据IP地址和子网掩码进行交换和路由，它将明确 PC1 希望和哪个 VLAN 网络的目标 PC 通信。一旦它收集了所有必要的信息，将在它们之间建立链接，并将数据从发送端路由到接收端。这样就完成了不同 VLAN 间的通信。
## 总结
二层与三层交换机之间有以下区别：
* 工作层级不同：二层交换机工作在数据链路层，三层交换机工作在网络层，三层交换机不仅实现了数据包的高速转发，还可以根据不同网络状况达到最优网络性能。
* 原理不同：二层交换机的原理是当交换机从某个端口收到一个数据包，它会先读取包中的源MAC地址，再去读取包中的目的MAC地址，并在地址表中查找对应的端口，如表中有和目的MAC地址对应的端口，就把数据包直接复制到这个端口上。三层交换机的原理比较简单，就是一次路由多次交换，通俗来说就是第一次进行源到目的的路由，三层交换机会将此数据转到二层，那么下次无论是目的到源还是源到目的都可以进行快速交换。
* 功能不同：二层交换机基于MAC地址访问，只做数据的转发，并且不能配置IP地址，而三层交换机将二层交换技术和三层转发功能结合在一起，也就是说三层交换机在二层交换机的基础上增加了路由功能，可配置不同VLAN的IP地址，可通过三层路由实现不同VLAN之间通讯。
* 应用不同：二层交换机主要用于网络接入层和汇聚层，而三层交换机主要用于网络核心层，但是也存在少部分三层交换机用于汇聚层的现象。
* 支持的协议不同：二层交换机支持物理层和数据链路层协议，而三层交换机支持物理层、数据链路层及网络层协议。
