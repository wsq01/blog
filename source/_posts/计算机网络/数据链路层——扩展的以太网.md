


# 在物理层扩展以太网
使用光纤扩展
主机使用光纤（通常是一对光纤）和一对光纤调制解调器连接到集线器。 
很容易使主机和几公里以外的集线器相连接。

{% asset_img img1.png %}

使用集线器扩展：将多个以太网段连成更大的、多级星形结构的以太网。

{% asset_img img2.png %}

用集线器扩展以太网
优点
使原来属于不同碰撞域的以太网上的计算机能够进行跨碰撞域的通信。
扩大了以太网覆盖的地理范围。
缺点
碰撞域增大了，但总的吞吐量并未提高。
如果不同的碰撞域使用不同的数据率，那么就不能用集线器将它们互连起来。 
## 碰撞域
碰撞域（collision domain）又称为冲突域，是指网络中一个站点发出的帧会与其他站点发出的帧产生碰撞或冲突的那部分网络。
碰撞域越大，发生碰撞的概率越高。

{% asset_img img3.png %}

# 在数据链路层扩展以太网
扩展以太网更常用的方法是在数据链路层进行。
早期使用网桥，现在使用以太网交换机。

{% asset_img img4.png %}
## 网桥与以太网交换机
网桥工作在数据链路层。
它根据 MAC 帧的目的地址对收到的帧进行转发和过滤。
当网桥收到一个帧时，并不是向所有的接口转发此帧，而是先检查此帧的目的 MAC 地址，然后再确定将该帧转发到哪一个接口，或把它丢弃。 

1990 年问世的交换式集线器 (switching hub) 可明显地提高以太网的性能。
交换式集线器常称为以太网交换机 (switch) 或第二层交换机 (L2 switch)，强调这种交换机工作在数据链路层。
## 以太网交换机的特点
以太网交换机实质上就是一个多接口的网桥。
通常都有十几个或更多的接口。
每个接口都直接与一个单台主机或另一个以太网交换机相连，并且一般都工作在全双工方式。
以太网交换机具有并行性。
能同时连通多对接口，使多对主机能同时通信。

相互通信的主机都是独占传输媒体，无碰撞地传输数据。

{% asset_img img5.png %}

以太网交换机的每个接口是一个碰撞域。

以太网交换机的接口有存储器，能在输出端口繁忙时把到来的帧进行缓存。
以太网交换机是一种即插即用设备，其内部的帧交换表（又称为地址表）是通过自学习算法自动地逐渐建立起来的。
以太网交换机使用了专用的交换结构芯片，用硬件转发，其转发速率要比使用软件转发的网桥快很多。
以太网交换机的性能远远超过普通的集线器，而且价格并不贵。
## 以太网交换机的优点
用户独享带宽，增加了总容量。
从共享总线以太网转到交换式以太网时，所有接入设备的软件和硬件、适配器等都不需要做任何改动。
以太网交换机一般都具有多种速率的接口，方便了各种不同情况的用户。


{% asset_img img6.png %}

## 以太网交换机的交换方式
存储转发方式
把整个数据帧先缓存后再进行处理。
直通 (cut-through) 方式
接收数据帧的同时就立即按数据帧的目的 MAC 地址决定该帧的转发接口，因而提高了帧的转发速度。
缺点是它不检查差错就直接将帧转发出去，因此有可能也将一些无效帧转发给其他的站。

在某些情况下，仍需要采用基于软件的存储转发方式进行交换，例如，当需要进行线路速率匹配、协议转换或差错检测时。
## 以太网交换机的自学习功能
以太网交换机运行自学习算法自动维护交换表。

{% asset_img img7.png %}
{% asset_img img8.png %}
{% asset_img img9.png %}
{% asset_img img10.png %}
{% asset_img img11.png %}

以太网交换机的这种自学习方法使得以太网交换机能够即插即用，不必人工进行配置，因此非常方便。
## 交换机自学习和转发帧的步骤归纳
{% asset_img img12.png %}

## 理解以太网交换机的自学习功能
{% asset_img img13.png %}
{% asset_img img14.png %}

## 交换机使用了生成树协议
IEEE 802.1D 标准制定了一个生成树协议 STP  (Spanning Tree Protocol)。
其要点是：不改变网络的实际拓扑，但在逻辑上则切断某些链路，使得从一台主机到所有其他主机的路径是无环路的树状结构，从而消除了兜圈子现象。
{% asset_img img15.png %}

## 从总线以太网到星形以太网
早期，以太网采用无源的总线结构。
现在，采用以太网交换机的星形结构成为以太网的首选拓扑。
总线以太网使用 CSMA/CD 协议，以半双工方式工作。
以太网交换机不使用共享总线，没有碰撞问题，因此不使用 CSMA/CD 协议，以全双工方式工作。但仍然采用以太网的帧结构。

{% asset_img img16.png %}

局域网存在的以下几个方面的问题：
扩展性
安全性
可管理性 等

所有计算机都处于同一个碰撞域（或冲突域）中和同一个广播域中。

{% asset_img img17.png %}
{% asset_img img18.png %}

## 广播域
广播域（broadcast domain）：指这样一部分网络，其中任何一台设备发出的广播通信都能被该部分网络中的所有其他设备所接收。

采用以太网交换机的星形以太网
每个接口都处于一个独立的碰撞域（或冲突域）中，但所有计算机都处于同一个广播域中。

{% asset_img img19.png %}
{% asset_img img20.png %}
# 虚拟局域网
利用以太网交换机可以很方便地实现虚拟局域网 VLAN (Virtual LAN)。
IEEE 802.1Q 对虚拟局域网 VLAN 的定义：
虚拟局域网 VLAN 是由一些局域网网段构成的与物理位置无关的逻辑组，而这些网段具有某些共同的需求。每一个 VLAN 的帧都有一个明确的标识符，指明发送这个帧的计算机是属于哪一个 VLAN。

虚拟局域网其实只是局域网给用户提供的一种服务，而并不是一种新型局域网。
由于虚拟局域网是用户和网络资源的逻辑组合，因此可按照需要将有关设备和资源非常方便地重新组合，使用户从不同的服务器或数据库中存取所需的资源。

{% asset_img img21.png %}

10 台计算机划分为三个虚拟局域网：
 VLAN1, VLAN2 和 VLAN3

每个虚拟局域网是一个广播域。
VLAN1, VLAN2 和 VLAN3 是三个不同的广播域。

当 B1 向 VLAN2 工作组内成员发送数据时，
工作站 B2 和 B3 将会收到其广播的信息。

B1 发送数据时，VLAN1 和 VLAN3 中的工作站 A1，A2 和 C1 等都不会收到 B1 发出的广播信息。

虚拟局域网限制了接收广播信息的工作站数，使得网络不会因传播过多的广播信息 (即“广播风暴”) 而引起性能恶化。

虚拟局域网（VLAN）技术具有以下主要优点：
改善了性能
简化了管理
降低了成本
改善了安全性
## 划分虚拟局域网的方法
基于交换机端口
基于计算机网卡的MAC地址
基于协议类型
基于IP子网地址
基于高层应用或服务

基于交换机端口的方法
最简单、也是最常用的方法。
属于在第一层划分虚拟局域网的方法。
缺点：不允许用户移动。

基于计算机网卡的MAC地址的方法
根据用户计算机的MAC地址划分虚拟局域网。
属于在第二层划分虚拟局域网的方法。
允许用户移动。
缺点：需要输入和管理大量的MAC地址。如果用户的MAC地址改变了，则需要管理员重新配置VLAN。

基于协议类型的方法
根据以太网帧的第三个字段“类型”字段确定该类型的协议属于哪一个虚拟局域网。
属于在第二层划分虚拟局域网的方法。

基于IP子网地址的方法
根据以太网帧的第三个字段“类型”字段和IP分组首部中的源 IP 地址字段确定该 IP 分组属于哪一个虚拟局域网。
属于在第三层划分虚拟局域网的方法。

基于高层应用或服务的方法
根据高层应用或服务、或者它们的组合划分虚拟局域网。
更加灵活，但更加复杂。

## 虚拟局域网使用的以太网帧格式
IEEE 批准了 802.3ac 标准，该标准定义了以太网的帧格式的扩展，以支持虚拟局域网。
虚拟局域网协议允许在以太网的帧格式中插入一个4字节的标识符，称为 VLAN 标记 (tag)，用来指明该帧属于哪一个虚拟局域网。
插入VLAN标记得出的帧称为 802.1Q 帧或带标记的以太网帧。

{% asset_img img22.png %}
{% asset_img img23.png %}